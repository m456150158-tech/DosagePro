<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dosage Pro â€“ by Mohamed Ibrahim</title>
<link rel="manifest" href="manifest.json">
<style>
body{font-family:Arial,sans-serif;margin:0;padding:0;background:#eef3f7;color:#111;transition:0.3s;}
.dark{background:#1e1e1e;color:white;}
header{background:#006d77;color:white;padding:20px;text-align:center;}
header h1{margin:0;font-size:22px;}
.container{max-width:480px;margin:20px auto;padding:0 15px;}
.card{background:white;border-radius:12px;padding:20px;margin-bottom:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1);transition:0.3s;}
.dark .card{background:#2c2c2c;}
.card h3{color:#023047;margin-top:0;}
input,select,button{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ccc;}
button{background:#006d77;color:white;border:none;cursor:pointer;}
button:hover{background:#023047;}
.result{margin-top:12px;font-size:15px;text-align:right;}
.toggle{cursor:pointer;font-size:14px;text-align:right;margin-bottom:12px;color:#0077b6;}
.warning{font-size:12px;color:red;margin-top:12px;text-align:center;}
</style>
</head>
<body>
<header>
<h1>Dosage Pro â€“ by Mohamed Ibrahim</h1>
</header>
<div class="container">
<div class="toggle" onclick="toggleDark()">ğŸŒ™ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</div>

<!-- Ø§Ù„Ù„ØºØ© -->
<div class="card">
<select id="lang" onchange="setLanguage()">
<option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
<option value="en">English</option>
</select>
</div>

<!-- Dose Calculator -->
<div class="card">
<h3 id="doseHeader">ğŸ’‰ Dose Calculator</h3>
<select id="ageType"><option value="adult">Adult</option><option value="child">Child</option></select>
<input type="number" id="weight" placeholder="Weight (kg)">
<select id="drugList"></select>
<button onclick="doseCalc()">Calculate Dose</button>
<div class="result" id="doseResult"></div>
</div>

<!-- BMI Calculator -->
<div class="card">
<h3 id="bmiHeader">âš–ï¸ BMI Calculator</h3>
<input type="number" id="height" placeholder="Height (cm)">
<button onclick="bmiCalc()">Calculate BMI</button>
<div class="result" id="bmiResult"></div>
</div>

<!-- Creatinine Clearance -->
<div class="card">
<h3 id="crclHeader">ğŸ§ª Creatinine Clearance</h3>
<input type="number" id="age" placeholder="Age">
<input type="number" id="scr" placeholder="Serum Creatinine (mg/dL)">
<select id="gender"><option value="male">Male</option><option value="female">Female</option></select>
<button onclick="crclCalc()">Calculate CrCl</button>
<div class="result" id="crclResult"></div>
</div>

<div class="warning">âš ï¸ This is an educational tool only.</div>
</div>

<script>
let lang="en";
let drugsData=[];

// Load drugs.json
fetch("drugs.json").then(res=>res.json()).then(data=>{drugsData=data.drugs;populateDrugs();});

function populateDrugs(){
const sel=document.getElementById("drugList"); sel.innerHTML="";
drugsData.forEach(d=>{
const opt=document.createElement("option"); opt.value=d.code;
opt.text=lang==="ar"?d.name_ar:d.name_en;
sel.add(opt);
});
}

function setLanguage(){lang=document.getElementById("lang").value;populateDrugs();}

// Dark Mode
function toggleDark(){document.body.classList.toggle("dark");}

// Dose Calculator
function doseCalc(){
const ageType=document.getElementById("ageType").value;
const weight=parseFloat(document.getElementById("weight").value);
const code=document.getElementById("drugList").value;
const d=drugsData.find(x=>x.code===code);
if(!weight){document.getElementById("doseResult").innerText=lang==="ar"?"Ø£Ø¯Ø®Ù„ ÙˆØ²Ù† ØµØ­ÙŠØ­":"Enter valid weight"; return;}
let text="";
switch(code){
case"cef": if(ageType==="child"){let min=weight*d.doseChildMin,max=weight*d.doseChildMax; text=lang==="ar"?`Ø³ÙŠÙØªØ±ÙŠØ§ÙƒØ³ÙˆÙ† Ù„Ù„Ø·ÙÙ„: ${min}-${max} ${d.unit}`:`Ceftriaxone (Child): ${min}-${max} ${d.unit}`;}else{text=lang==="ar"?`Ø¬Ø±Ø¹Ø© Ø¨Ø§Ù„Øº: ${d.doseAdultRange} ${d.unit}`:`Adult dose: ${d.doseAdultRange} ${d.unit}`;} break;
case"gent": let min=weight*d.doseMin,max=weight*d.doseMax; text=lang==="ar"?`Ø¬Ù†ØªØ§Ù…ÙŠØ³ÙŠÙ†: ${min}-${max} ${d.unit}`:`Gentamicin: ${min}-${max} ${d.unit}`; break;
case"para": let minP=weight*d.doseMin,maxP=weight*d.doseMax,maxD=weight*d.maxDaily; text=lang==="ar"?`Ø¨Ø§Ø±Ø§Ø³ÙŠØªØ§Ù…ÙˆÙ„ IV: ${minP}-${maxP} ${d.unit}, Ø­Ø¯ Ø£Ù‚ØµÙ‰ ÙŠÙˆÙ…ÙŠÙ‹Ø§ ${maxD} ${d.unit}`:`Paracetamol IV: ${minP}-${maxP} ${d.unit}, max daily ${maxD} ${d.unit}`; break;
case"clex": text=lang==="ar"?`ÙƒÙ„ÙŠÙƒØ³ÙŠÙ†: ${weight*d.doseAdult} ${d.unit}`:`Clexane: ${weight*d.doseAdult} ${d.unit}`; break;
case"insulin": text=lang==="ar"?d.notes_ar:d.notes_en; break;
case"heparin": let load=weight*d.doseInit; text=lang==="ar"?`Ù‡ÙŠØ¨Ø§Ø±ÙŠÙ†: ØªØ­Ù…ÙŠÙ„Ø© ${load} ÙˆØ­Ø¯Ø©ØŒ Ø«Ù… ${d.doseInfusion} ÙˆØ­Ø¯Ø©/ÙƒØ¬Ù…/Ø³Ø§Ø¹Ø©`:`Heparin: ${load} IU loading, then ${d.doseInfusion} IU/kg/hr`; break;
}
document.getElementById("doseResult").innerHTML=text;
}

// BMI
function bmiCalc(){const w=parseFloat(document.getElementById("weight").value); const h=parseFloat(document.getElementById("height").value)/100;
if(!w||!h){document.getElementById("bmiResult").innerText=lang==="ar"?"Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©":"Enter valid data"; return;}
const bmi=(w/(h*h)).toFixed(2);
document.getElementById("bmiResult").innerText=(lang==="ar"?`BMI = ${bmi}`:`BMI = ${bmi}`);
}

// CrCl
function crclCalc(){const age=parseFloat(document.getElementById("age").value); const w=parseFloat(document.getElementById("weight").value); const scr=parseFloat(document.getElementById("scr").value); const gender=document.getElementById("gender").value;
if(!age||!w||!scr){document.getElementById("crclResult").innerText=lang==="ar"?"Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©":"Enter complete data"; return;}
let cr=((140-age)*w)/(72*scr); if(gender==="female") cr*=0.85; document.getElementById("crclResult").innerText=(lang==="ar"?`CrCl â‰ˆ ${cr.toFixed(2)} mL/min`:`CrCl â‰ˆ ${cr.toFixed(2)} mL/min`);
}

// Register Service Worker
if('serviceWorker' in navigator){navigator.serviceWorker.register('/service-worker.js');}
</script>
</body>
</html>
{
  "drugs": [
    {
      "code": "cef",
      "name_ar": "Ø³ÙŠÙØªØ±ÙŠØ§ÙƒØ³ÙˆÙ†",
      "name_en": "Ceftriaxone",
      "doseChildMin": 50,
      "doseChildMax": 75,
      "doseAdultRange": "1000-2000",
      "unit": "mg",
      "notes_ar": "Ø¬Ø±Ø¹Ø© Ø·ÙÙ„ 50-75 Ù…Ø¬/ÙƒØ¬Ù… ÙŠÙˆÙ…ÙŠÙ‹Ø§",
      "notes_en": "Child: 50â€“75 mg/kg/day"
    },
    {
      "code": "gent",
      "name_ar": "Ø¬Ù†ØªØ§Ù…ÙŠØ³ÙŠÙ†",
      "name_en": "Gentamicin",
      "doseMin": 5,
      "doseMax": 7,
      "unit": "mg",
      "notes_ar": "5â€“7 Ù…Ø¬/ÙƒØ¬Ù… ÙŠÙˆÙ…ÙŠÙ‹Ø§ â€” Ø§Ø¶Ø¨Ø· Ø­Ø³Ø¨ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙƒÙ„Ù‰",
      "notes_en": "5â€“7 mg/kg/day â€” adjust per renal function"
    },
    {
      "code": "para",
      "name_ar": "Ø¨Ø§Ø±Ø§Ø³ÙŠØªØ§Ù…ÙˆÙ„ IV",
      "name_en": "Paracetamol IV",
      "doseMin": 10,
      "doseMax": 15,
      "maxDaily": 60,
      "unit": "mg",
      "notes_ar": "10â€“15 Ù…Ø¬/ÙƒØ¬Ù… ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§ØªØŒ Ø­Ø¯ Ø£Ù‚ØµÙ‰ ÙŠÙˆÙ…ÙŠÙ‹Ø§ 60 Ù…Ø¬/ÙƒØ¬Ù…",
      "notes_en": "10â€“15 mg/kg every 6h, max 60 mg/kg/day"
    },
    {
      "code": "clex",
      "name_ar": "ÙƒÙ„ÙŠÙƒØ³ÙŠÙ† (Enoxaparin)",
      "name_en": "Clexane",
      "doseAdult": 1,
      "unit": "mg/kg",
      "notes_ar": "1 Ù…Ø¬/ÙƒØ¬Ù… ÙƒÙ„ 12 Ø³Ø§Ø¹Ø© Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø¬Ù„Ø·Ø©",
      "notes_en": "1 mg/kg every 12h for clot treatment"
    },
    {
      "code": "insulin",
      "name_ar": "Ø¥Ù†Ø³ÙˆÙ„ÙŠÙ†",
      "name_en": "Insulin",
      "notes_ar": "0.5â€“1 ÙˆØ­Ø¯Ø©/ÙƒØ¬Ù… ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø·Ø¨Ù‚Ù‹Ø§ Ù„Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„",
      "notes_en": "0.5â€“1 unit/kg/day per protocol"
    },
    {
      "code": "heparin",
      "name_ar": "Ù‡ÙŠØ¨Ø§Ø±ÙŠÙ†",
      "name_en": "Heparin",
      "doseInit": 80,
      "doseInfusion": 18,
      "unit": "IU/kg",
      "notes_ar": "ØªØ­Ù…ÙŠÙ„Ø© 80 ÙˆØ­Ø¯Ø©ØŒ Ø«Ù… 18 ÙˆØ­Ø¯Ø©/ÙƒØ¬Ù…/Ø³Ø§Ø¹Ø©",
      "notes_en": "80 IU loading, then 18 IU/kg/hr"
    }
  ]
}
{
  "name": "Dosage Pro â€“ by Mohamed Ibrahim",
  "short_name": "DosagePro",
  "description": "Clinical Tool for Dose Calculations + BMI + CrCl",
  "lang": "ar",
  "start_url": "/index.html",
  "display": "standalone",
  "background_color": "#eef3f7",
  "theme_color": "#006d77",
  "icons": [
    { "src": "icons/icon-192.png", "sizes": "192x192", "type": "image/png" },
    { "src": "icons/icon-512.png", "sizes": "512x512", "type": "image/png" }
  ]
}
const CACHE_NAME = "dosage-pro-cache-v1";
const FILES_TO_CACHE = [
  "/index.html",
  "/manifest.json",
  "/drugs.json",
  "/service-worker.js"
];

self.addEventListener("install", evt => {
  evt.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(FILES_TO_CACHE)));
});

self.addEventListener("fetch", evt => {
  evt.respondWith(caches.match(evt.request).then(resp => resp || fetch(evt.request)));
});
